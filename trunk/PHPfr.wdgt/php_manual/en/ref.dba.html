<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>Database (dbm-style) Abstraction Layer Functions</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 </head>
 <body><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.dbplus-xunlockrel.html">dbplus_xunlockrel</a></div>
 <div class="next" style="float: right;"><a href="function.dba-close.html">dba_close</a></div>
 <div class="up"><a href="funcref.html">Function Reference</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div>
  <h1 class="title">Database (dbm-style) Abstraction Layer Functions</h1>
  

  <div class="partintro">
   <div id="dba.intro" class="section">
    <h2 class="title">Introduction</h2>
   <p class="para">
    These functions build the foundation for accessing Berkeley DB
    style databases.
   </p>
   <p class="para">
    This is a general abstraction layer for several file-based databases.
    As such, functionality is limited to a common subset of features
    supported by modern databases such as
    <a href="http://www.sleepycat.com/" class="link external">&raquo; Sleepycat Software&#039;s DB2</a>.
    (This is not to be confused with IBM&#039;s DB2 software, which is
    supported through the <a href="ref.uodbc.html" class="link">ODBC functions</a>.)
   </p>
  </div>
   <div id="dba.requirements" class="section">
    <h2 class="title">Requirements</h2>
    <p class="para">
     The behaviour of various aspects depends on the implementation of the
     underlying database. Functions such as <a href="function.dba-optimize.html" class="function">dba_optimize()</a>
     and <a href="function.dba-sync.html" class="function">dba_sync()</a> will do what they promise for one
     database and will do nothing for others. You have to download and install
     supported dba-Handlers.
    <table border="5">
     <caption><b>List of DBA handlers</b></caption>
     <colgroup>

      <thead valign="middle">
       <tr valign="middle">
        <th colspan="1">Handler</th>
        <th colspan="1">Notes</th>
       </tr>

      </thead>

      <tbody valign="middle">
       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">dbm</i></td>
        <td colspan="1" rowspan="1" align="left">
         Dbm is the oldest (original) type of Berkeley DB style
         databases. You should avoid it, if possible. We do not support
         the compatibility functions built into DB2 and gdbm, because
         they are only compatible on the source code level, but cannot
         handle the original dbm format.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">ndbm</i></td>
        <td colspan="1" rowspan="1" align="left">
         Ndbm is a newer type and more flexible than dbm. It still has
         most of the arbitrary limits of dbm (therefore it is
         deprecated).
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">gdbm</i></td>
        <td colspan="1" rowspan="1" align="left">
         Gdbm is the <a href="ftp://ftp.gnu.org/pub/gnu/gdbm/" class="link external">&raquo; GNU database
         manager</a>.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">db2</i></td>
        <td colspan="1" rowspan="1" align="left">
         DB2 is <a href="http://www.sleepycat.com/" class="link external">&raquo; Sleepycat Software&#039;s
         DB2</a>. It is described as &quot;a programmatic toolkit that
         provides high-performance built-in database support for both
         standalone and client/server applications.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">db3</i></td>
        <td colspan="1" rowspan="1" align="left">
         DB3 is <a href="http://www.sleepycat.com/" class="link external">&raquo; Sleepycat Software&#039;s
         DB3</a>.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">db4</i></td>
        <td colspan="1" rowspan="1" align="left">
         DB4 is <a href="http://www.sleepycat.com/" class="link external">&raquo; Sleepycat Software&#039;s
         DB4</a>. This is available since PHP 4.3.2.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">cdb</i></td>
        <td colspan="1" rowspan="1" align="left">
         Cdb is &quot;a fast, reliable, lightweight package for creating and
         reading constant databases.&quot; It is from the author of qmail and
         can be found at <a href="http://cr.yp.to/cdb.html" class="link external">&raquo; http://cr.yp.to/cdb.html</a>. Since it is
         constant, we support only reading operations. And since PHP 4.3.0
         we support writing (not updating) through the internal cdb library.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">cdb_make</i></td>
        <td colspan="1" rowspan="1" align="left">
         Since PHP 4.3.0 we support creation (not updating) of cdb files 
         when the bundled cdb library is used.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">flatfile</i></td>
        <td colspan="1" rowspan="1" align="left">
         This is available since PHP 4.3.0 for compatibility with the deprecated
         <a href="ref.dbm.html" class="link">dbm</a> extension only and should be avoided. 
         However you may use this where files were created in this format. That
         happens when configure could not find any external library.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">inifile</i></td>
        <td colspan="1" rowspan="1" align="left">
         This is available since PHP 4.3.3 to be able to modify php.ini files 
         from within PHP scripts. When working with ini files you can pass arrays 
         of the form array(0=&gt;group,1=&gt;value_name) or strings of the form 
         &quot;[group]value_name&quot; where group is optional. As the functions 
         <a href="function.dba-firstkey.html" class="function">dba_firstkey()</a> and <a href="function.dba-nextkey.html" class="function">dba_nextkey()</a>
         return string representations of the key there is a new function
         <a href="function.dba-key-split.html" class="function">dba_key_split()</a> available since PHP 5 which allows
         to convert the string keys into array keys without loosing <b><tt>FALSE</tt></b>.
        </td>
       </tr>


       <tr valign="middle">
        <td colspan="1" rowspan="1" align="left"><i class="literal">qdbm</i></td>
        <td colspan="1" rowspan="1" align="left">
         This is available since PHP 5.0.0. The qdbm library can be loaded from
         <a href="http://qdbm.sourceforge.net" class="link external">&raquo; http://qdbm.sourceforge.net</a>.
        </td>
       </tr>


      </tbody>
     </colgroup>

    </table>

    </p>
    <p class="para">
     When invoking the <a href="function.dba-open.html" class="function">dba_open()</a> or
     <a href="function.dba-popen.html" class="function">dba_popen()</a> functions, one of the
     handler names must be supplied as an argument. The actually
     available list of handlers is displayed by invoking
     <a href="function.phpinfo.html" class="function">phpinfo()</a> or <a href="function.dba-handlers.html" class="function">dba_handlers()</a>.
    </p>
   </div>

   

<div id="dba.installation" class="section">
 <h2 class="title">Installation</h2>
 <p class="para">
  By using the <span class="option">--enable-dba=shared</span>
  configuration option you can build a dynamic loadable module to enable PHP
  for basic support of dbm-style databases. You also have to add support
  for at least one of the following handlers by specifying the
  <span class="option">--with-XXXX</span> configure switch to your PHP
  configure line.
 </p>
 <div class="warning"><b class="warning">Warning</b>
  <p class="para">
   After configuring and compiling PHP you must execute the following test
   from commandline: <i class="literal">php run-tests.php ext/dba</i>. This shows
   whether your combination of handlers works. Most problematic are 
   <i class="literal">dbm</i> and <i class="literal">ndbm</i> which conflict with
   many installations. The reason for this is that on several systems these
   libraries are part of more than one other library. The configuration test
   only prevents you from configuring malfunctioning single handlers but not 
   combinations.
  </p>
 </div>
 <p class="para">
  <table border="5">
   <caption><b>Supported DBA handlers</b></caption>
   <colgroup>

    <thead valign="middle">
     <tr valign="middle">
      <th colspan="1">Handler</th>
      <th colspan="1">Configure Switch</th>
     </tr>

    </thead>

    <tbody valign="middle">
     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">dbm</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for dbm add
       <span class="option">--with-dbm[=DIR]</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         dbm normally is a wrapper which often results in failures.
         This means you should only use dbm if you are sure it works
         and if you really need this format.
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">ndbm</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for ndbm add
       <span class="option">--with-ndbm[=DIR]</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         ndbm normally is a wrapper which often results in failures.
         This means you should only use ndbm if you are sure it works
         and if you really need this format.
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">gdbm</i></td>
      <td colspan="1" rowspan="1" align="left">
       To enable support for gdbm add
       <span class="option">--with-gdbm[=DIR]</span>.
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">db2</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for db2 add
       <span class="option">--with-db2[=DIR]</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         db2 conflicts with db3 and db4.
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">db3</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for db3 add
       <span class="option">--with-db3[=DIR]</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         db3 conflicts with db2 and db4.
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">db4</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for db4 add
       <span class="option">--with-db4[=DIR]</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         db4 conflicts with db2 and db3.
        <br />
       </p></blockquote>
       <blockquote><p><b class="note">Note</b>: 
        
         This was added in PHP 4.3.2. In earlier versions of PHP you need to use
         <span class="option">--with-db3=DIR</span> with DIR being the
         path to db4 library. It is not possible to use db versions starting 
         from 4.1 with PHP prior to version 4.3.0. Also, the db libraries with
         versions 4.1 through 4.1.24 cannot be used in any PHP version.
        <br />
       </p></blockquote>
      </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">cdb</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for cdb add
       <span class="option">--with-cdb[=DIR]</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         Since PHP 4.3.0 you can omit DIR to use the bundled cdb library 
         that adds the cdb_make handler which allows creation of cdb files
         and allows to access cdb files on the network using PHP&#039;s streams.
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">flatfile</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for flatfile add
       <span class="option">--with-flatfile</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         This was added in PHP 4.3.0 to add compatibility with deprecated
         <a href="ref.dbm.html" class="link">dbm</a> extension. Use this handler only
         when you cannot install one of the libraries required by the other
         handlers and when you cannot use bundled cdb handler.
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">inifile</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for inifile add
       <span class="option">--with-inifile</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         This was added in PHP 5.0.0 and allows to read and set microsoft style
         <var class="filename">.ini</var> files (like the <var class="filename">php.ini</var> file).
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


     <tr valign="middle">
      <td colspan="1" rowspan="1" align="left"><i class="literal">qdbm</i></td>
      <td colspan="1" rowspan="1" align="left">
       <p class="para">
       To enable support for qdbm add
       <span class="option">--with-qdbm[=DIR]</span>.
       <blockquote><p><b class="note">Note</b>: 
        
         qdbm conflicts with dbm and gdbm.
        <br />
       </p></blockquote>
       <blockquote><p><b class="note">Note</b>: 
        
         This was added in PHP 5.0.0. The qdbm library can be loaded from
         <a href="http://qdbm.sourceforge.net" class="link external">&raquo; http://qdbm.sourceforge.net</a>.
        <br />
       </p></blockquote>
       </p>
      </td>
     </tr>


    </tbody>
   </colgroup>

  </table>

  <blockquote><p><b class="note">Note</b>: 
   
    Up to PHP 4.3.0 you are able to add both db2 and db3 handler but only one
    of them can be used internally. That means that you cannot have both file 
    formats. Starting with PHP 5.0.0 there is a configuration check avoid such
    misconfigurations.
   <br />
  </p></blockquote>
 </p>
</div>




   <div id="dba.runtime" class="section">
    <h2 class="title">Runtime Configuration</h2>
    <p class="para">This extension has no configuration directives defined in <var class="filename">php.ini</var>.</p>
   </div>
   
   <div id="dba.resources" class="section">
    <h2 class="title">Resource Types</h2>
    <p class="para">
    The functions <a href="function.dba-open.html" class="function">dba_open()</a> and
    <a href="function.dba-popen.html" class="function">dba_popen()</a> return a handle to the specified
    database file to access which is used by all other dba-function calls.
    </p>
   </div>
   
   <div id="dba.constants" class="section">
    <h2 class="title">Predefined Constants</h2>
    <p class="para">This extension has no constants defined.</p>
   </div>
   
   <div id="dba.examples" class="section">
    <h2 class="title">Examples</h2>
     <p class="para">
      <div class="example">
       <p><b>Example#1 DBA example</b></p>
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br />$id&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">dba_open</span><span style="color: #007700">(</span><span style="color: #DD0000">"/tmp/test.db"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"db2"</span><span style="color: #007700">);<br /><br />if&nbsp;(!</span><span style="color: #0000BB">$id</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"dba_open&nbsp;failed\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;exit;<br />}<br /><br /></span><span style="color: #0000BB">dba_replace</span><span style="color: #007700">(</span><span style="color: #DD0000">"key"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"This&nbsp;is&nbsp;an&nbsp;example!"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /><br />if&nbsp;(</span><span style="color: #0000BB">dba_exists</span><span style="color: #007700">(</span><span style="color: #DD0000">"key"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">dba_fetch</span><span style="color: #007700">(</span><span style="color: #DD0000">"key"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">dba_delete</span><span style="color: #007700">(</span><span style="color: #DD0000">"key"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">dba_close</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
    <p class="para">
     DBA is binary safe and does not have any arbitrary limits.
     However, it inherits all limits set by the underlying
     database implementation.
    </p>
    <p class="para">
     All file-based databases must provide a way of setting the file
     mode of a new created database, if that is possible at all. The
     file mode is commonly passed as the fourth argument to
     <a href="function.dba-open.html" class="function">dba_open()</a> or <a href="function.dba-popen.html" class="function">dba_popen()</a>.
    </p>
    <p class="para">
     You can access all entries of a database in a linear way by using the
     <a href="function.dba-firstkey.html" class="function">dba_firstkey()</a> and <a href="function.dba-nextkey.html" class="function">dba_nextkey()</a>
     functions. You may not change the database while traversing it.
    </p> 
    <p class="para">
     <div class="example">
      <p><b>Example#2 Traversing a database</b></p>
      <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /><br /></span><span style="color: #FF8000">//&nbsp;...open&nbsp;database...<br /><br /></span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">dba_firstkey</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br /><br />while&nbsp;(</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">!=&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;remember&nbsp;the&nbsp;key&nbsp;to&nbsp;perform&nbsp;some&nbsp;action&nbsp;later<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$handle_later</span><span style="color: #007700">[]&nbsp;=&nbsp;</span><span style="color: #0000BB">$key</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$key&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">dba_nextkey</span><span style="color: #007700">(</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br />}<br /><br />foreach&nbsp;(</span><span style="color: #0000BB">$handle_later&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$val</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">dba_delete</span><span style="color: #007700">(</span><span style="color: #0000BB">$val</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$id</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
      </div>

     </div>
    </p>
   </div>

  </div>





























































































 <h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.dba-close.html">dba_close</a> — Close a DBA database</li><li><a href="function.dba-delete.html">dba_delete</a> — Delete DBA entry specified by key</li><li><a href="function.dba-exists.html">dba_exists</a> — Check whether key exists</li><li><a href="function.dba-fetch.html">dba_fetch</a> — Fetch data specified by key</li><li><a href="function.dba-firstkey.html">dba_firstkey</a> — Fetch first key</li><li><a href="function.dba-handlers.html">dba_handlers</a> — List all the handlers available</li><li><a href="function.dba-insert.html">dba_insert</a> — Insert entry</li><li><a href="function.dba-key-split.html">dba_key_split</a> — Splits a key in string representation into array representation</li><li><a href="function.dba-list.html">dba_list</a> — List all open database files</li><li><a href="function.dba-nextkey.html">dba_nextkey</a> — Fetch next key</li><li><a href="function.dba-open.html">dba_open</a> — Open database</li><li><a href="function.dba-optimize.html">dba_optimize</a> — Optimize database</li><li><a href="function.dba-popen.html">dba_popen</a> — Open database persistently</li><li><a href="function.dba-replace.html">dba_replace</a> — Replace or insert entry</li><li><a href="function.dba-sync.html">dba_sync</a> — Synchronize database</li></ul>
</div>
<hr /><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.dbplus-xunlockrel.html">dbplus_xunlockrel</a></div>
 <div class="next" style="float: right;"><a href="function.dba-close.html">dba_close</a></div>
 <div class="up"><a href="funcref.html">Function Reference</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
