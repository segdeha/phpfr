<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <title>XML Parser Functions</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
 </head>
 <body><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.xdiff-string-patch.html">xdiff_string_patch</a></div>
 <div class="next" style="float: right;"><a href="function.utf8-decode.html">utf8_decode</a></div>
 <div class="up"><a href="funcref.html">Function Reference</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div>
  <h1 class="title">XML Parser Functions</h1>
  

  <div class="partintro">

   <div id="xml.intro" class="section">
    <h2 class="title">Introduction</h2>
    <p class="para">
     XML (eXtensible Markup Language) is a data format for structured
     document interchange on the Web.  It is a standard defined by
     The World Wide Web consortium (W3C).  Information about XML and
     related technologies can be found at <a href="http://www.w3.org/XML/" class="link external">&raquo; http://www.w3.org/XML/</a>.
    </p>
    <p class="para">
     This PHP extension implements support for James Clark&#039;s
     <span class="productname">expat</span> in PHP.  This toolkit lets you
     parse, but not validate, XML documents.  It supports three
     source <a href="ref.xml.html#xml.encoding" class="link">character encodings</a>
     also provided by PHP: <i class="literal">US-ASCII</i>,
     <i class="literal">ISO-8859-1</i> and <i class="literal">UTF-8</i>.
     <i class="literal">UTF-16</i> is not supported.
    </p>
    <p class="para">
     This extension lets you <a href="function.xml-parser-create.html" class="link">create XML parsers</a>
     and then define <em class="emphasis">handlers</em> for different XML
     events.  Each XML parser also has a few <a href="function.xml-parser-set-option.html" class="link">parameters</a> you
     can adjust.
    </p>
   </div>

   <div id="xml.requirements" class="section">
    <h2 class="title">Requirements</h2>
    <p class="para">
     This extension uses an <span class="productname">expat compat layer</span> by
     default. It can use also <span class="productname">expat</span>, which can
     be found at <a href="http://www.jclark.com/xml/expat.html" class="link external">&raquo; http://www.jclark.com/xml/expat.html</a>.  The
     Makefile that comes with expat does not build a library by
     default, you can use this make rule for that:
     <div class="example-contents">
<div class="cdata"><pre>
libexpat.a: $(OBJS)
    ar -rc $@ $(OBJS)
    ranlib $@
</pre></div>
     </div>

     A source RPM package of expat can be found at <a href="http://sourceforge.net/projects/expat/" class="link external">&raquo; http://sourceforge.net/projects/expat/</a>.
    </p>
   </div>

   

<div id="xml.installation" class="section">
 <h2 class="title">Installation</h2>
 <p class="para">
  These functions are enabled by default, using the bundled expat library.
  You can disable XML support with
  <span class="option">--disable-xml</span>.
  If you compile PHP as a module for Apache 1.3.9 or later, PHP will
  automatically use the bundled <span class="productname">expat</span> library from
  Apache. In order you don&#039;t want to use the bundled expat library configure
  PHP <span class="option">--with-expat-dir=DIR</span>, where DIR should
  point to the base installation directory of expat.
 </p>
 <p class="simpara"> The windows version of PHP has built in
support for this extension. You do not need to load any additional
extension in order to use these functions.</p>
</div>





   <div id="xml.configuration" class="section">
    <h2 class="title">Runtime Configuration</h2>
    <p class="para">This extension has no configuration directives defined in <var class="filename">php.ini</var>.</p>
   </div>

   <div id="xml.resources" class="section">
    <h2 class="title">Resource Types</h2>
    <div id="xml.resources.xml" class="section">
     <h2 class="title"><i class="literal">xml</i></h2>
     <p class="para">
      The <i class="literal">xml</i> resource as returned by
      <a href="function.xml-parser-create.html" class="function">xml_parser_create()</a> and
      <a href="function.xml-parser-create-ns.html" class="function">xml_parser_create_ns()</a> references an xml
      parser instance to be used with the functions provided by this
      extension.
     </p>
    </div>
   </div>

   

<div id="xml.constants" class="section">
 <h2 class="title">Predefined Constants</h2>
 <p class="simpara">
The constants below are defined by this extension, and
will only be available when the extension has either
been compiled into PHP or dynamically loaded at runtime.
</p>
 <dl>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_NONE</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_NO_MEMORY</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_SYNTAX</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_NO_ELEMENTS</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_INVALID_TOKEN</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNCLOSED_TOKEN</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_PARTIAL_CHAR</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_TAG_MISMATCH</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_DUPLICATE_ATTRIBUTE</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_JUNK_AFTER_DOC_ELEMENT</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_PARAM_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNDEFINED_ENTITY</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_RECURSIVE_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_ASYNC_ENTITY</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_BAD_CHAR_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_BINARY_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_ATTRIBUTE_EXTERNAL_ENTITY_REF</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_MISPLACED_XML_PI</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNKNOWN_ENCODING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_INCORRECT_ENCODING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_UNCLOSED_CDATA_SECTION</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_ERROR_EXTERNAL_ENTITY_HANDLING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_CASE_FOLDING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_TARGET_ENCODING</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_SKIP_TAGSTART</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

  <dt>

   <span class="term">
    <b><tt>XML_OPTION_SKIP_WHITE</tt></b> 
    (<a href="language.types.integer.html" class="type integer">integer</a>)
   </span>
   <dd>

    <span class="simpara">
     
    </span>
   </dd>

  </dt>

 </dl>

</div>





    <div id="xml.eventhandlers" class="section">
     <h2 class="title">Event Handlers</h2>
     <p class="para">
      The XML event handlers defined are:
      <table border="5">
       <caption><b>Supported XML handlers</b></caption>
       <colgroup>

        <thead valign="middle">
         <tr valign="middle">
          <th colspan="1">PHP function to set handler</th>
          <th colspan="1">Event description</th>
         </tr>

        </thead>

        <tbody valign="middle">
         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left"><a href="function.xml-set-element-handler.html" class="function">xml_set_element_handler()</a></td>
          <td colspan="1" rowspan="1" align="left">
           Element events are issued whenever the XML parser
           encounters start or end tags.  There are separate handlers
           for start tags and end tags.
          </td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">
           <a href="function.xml-set-character-data-handler.html" class="function">xml_set_character_data_handler()</a>
          </td>
          <td colspan="1" rowspan="1" align="left">
           Character data is roughly all the non-markup contents of
           XML documents, including whitespace between tags.  Note
           that the XML parser does not add or remove any whitespace,
           it is up to the application (you) to decide whether
           whitespace is significant.
          </td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">
           <a href="function.xml-set-processing-instruction-handler.html" class="function">xml_set_processing_instruction_handler()</a>
          </td>
          <td colspan="1" rowspan="1" align="left">
           PHP programmers should be familiar with processing
           instructions (PIs) already.  &lt;?php ?&gt; is a processing
           instruction, where <span class="replaceable">php</span> is called
           the &quot;PI target&quot;.  The handling of these are
           application-specific, except that all PI targets starting
           with &quot;XML&quot; are reserved.
          </td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left"><a href="function.xml-set-default-handler.html" class="function">xml_set_default_handler()</a></td>
          <td colspan="1" rowspan="1" align="left">
           What goes not to another handler goes to the default
           handler.  You will get things like the XML and document
           type declarations in the default handler.
          </td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">
           <a href="function.xml-set-unparsed-entity-decl-handler.html" class="function">xml_set_unparsed_entity_decl_handler()</a>
          </td>
          <td colspan="1" rowspan="1" align="left">
           This handler will be called for declaration of an unparsed
           (NDATA) entity.
          </td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">
           <a href="function.xml-set-notation-decl-handler.html" class="function">xml_set_notation_decl_handler()</a>
          </td>
          <td colspan="1" rowspan="1" align="left">
           This handler is called for declaration of a notation.
          </td>
         </tr>

         <tr valign="middle">
          <td colspan="1" rowspan="1" align="left">
           <a href="function.xml-set-external-entity-ref-handler.html" class="function">xml_set_external_entity_ref_handler()</a>
          </td>
          <td colspan="1" rowspan="1" align="left">
           This handler is called when the XML parser finds a
           reference to an external parsed general entity.  This can
           be a reference to a file or URL, for example.  See <a href="ref.xml.html#example.xml-external-entity" class="link">the external entity
           example</a> for a demonstration.
          </td>
         </tr>

        </tbody>
       </colgroup>

      </table>

     </p>
    </div>

    <div id="xml.case-folding" class="section">
     <h2 class="title">Case Folding</h2>
     <p class="para">
      The element handler functions may get their element names
      <span class="glossterm">case-folded</span>.  Case-folding is defined by
      the XML standard as &quot;a process applied to a sequence of
      characters, in which those identified as non-uppercase are
      replaced by their uppercase equivalents&quot;.  In other words, when
      it comes to XML, case-folding simply means uppercasing.
     </p>
     <p class="para">
      By default, all the element names that are passed to the handler
      functions are case-folded.  This behaviour can be queried and
      controlled per XML parser with the
      <a href="function.xml-parser-get-option.html" class="function">xml_parser_get_option()</a> and
      <a href="function.xml-parser-set-option.html" class="function">xml_parser_set_option()</a> functions,
      respectively.
     </p>
    </div>

    <div id="xml.error-codes" class="section">
     <h2 class="title">Error Codes</h2>
     <p class="para">
      The following constants are defined for XML error codes (as
      returned by <a href="function.xml-parse.html" class="function">xml_parse()</a>):
      <ul class="simplelist">
       <li class="member">XML_ERROR_NONE</li>
       <li class="member">XML_ERROR_NO_MEMORY</li>
       <li class="member">XML_ERROR_SYNTAX</li>
       <li class="member">XML_ERROR_NO_ELEMENTS</li>
       <li class="member">XML_ERROR_INVALID_TOKEN</li>
       <li class="member">XML_ERROR_UNCLOSED_TOKEN</li>
       <li class="member">XML_ERROR_PARTIAL_CHAR</li>
       <li class="member">XML_ERROR_TAG_MISMATCH</li>
       <li class="member">XML_ERROR_DUPLICATE_ATTRIBUTE</li>
       <li class="member">XML_ERROR_JUNK_AFTER_DOC_ELEMENT</li>
       <li class="member">XML_ERROR_PARAM_ENTITY_REF</li>
       <li class="member">XML_ERROR_UNDEFINED_ENTITY</li>
       <li class="member">XML_ERROR_RECURSIVE_ENTITY_REF</li>
       <li class="member">XML_ERROR_ASYNC_ENTITY</li>
       <li class="member">XML_ERROR_BAD_CHAR_REF</li>
       <li class="member">XML_ERROR_BINARY_ENTITY_REF</li>
       <li class="member">XML_ERROR_ATTRIBUTE_EXTERNAL_ENTITY_REF</li>
       <li class="member">XML_ERROR_MISPLACED_XML_PI</li>
       <li class="member">XML_ERROR_UNKNOWN_ENCODING</li>
       <li class="member">XML_ERROR_INCORRECT_ENCODING</li>
       <li class="member">XML_ERROR_UNCLOSED_CDATA_SECTION</li>
       <li class="member">XML_ERROR_EXTERNAL_ENTITY_HANDLING</li>
      </ul>
     </p>
    </div>

    <div id="xml.encoding" class="section">
     <h2 class="title">Character Encoding</h2>
     <p class="para">
      PHP&#039;s XML extension supports the <a href="http://www.unicode.org/" class="link external">&raquo; Unicode</a> character set through
      different <span class="glossterm">character encoding</span>s.  There are
      two types of character encodings, <span class="glossterm">source
      encoding</span> and <span class="glossterm">target encoding</span>.
      PHP&#039;s internal representation of the document is always encoded
      with <i class="literal">UTF-8</i>.
     </p>
     <p class="para">
      Source encoding is done when an XML document is <a href="function.xml-parse.html" class="link">parsed</a>.  Upon <a href="function.xml-parser-create.html" class="link">creating an XML
      parser</a>, a source encoding can be specified (this encoding
      can not be changed later in the XML parser&#039;s lifetime).  The
      supported source encodings are <i class="literal">ISO-8859-1</i>,
      <i class="literal">US-ASCII</i> and <i class="literal">UTF-8</i>.  The
      former two are single-byte encodings, which means that each
      character is represented by a single byte.
      <i class="literal">UTF-8</i> can encode characters composed by a
      variable number of bits (up to 21) in one to four bytes.  The
      default source encoding used by PHP is
      <i class="literal">ISO-8859-1</i>.
     </p>
     <p class="para">
      Target encoding is done when PHP passes data to XML handler
      functions.  When an XML parser is created, the target encoding
      is set to the same as the source encoding, but this may be
      changed at any point.  The target encoding will affect character
      data as well as tag names and processing instruction targets.
     </p>
     <p class="para">
      If the XML parser encounters characters outside the range that
      its source encoding is capable of representing, it will return
      an error.  
     </p>
     <p class="para">
      If PHP encounters characters in the parsed XML document that can
      not be represented in the chosen target encoding, the problem
      characters will be &quot;demoted&quot;.  Currently, this means that such
      characters are replaced by a question mark.
     </p>
    </div>

   <div id="xml.examples" class="section">
    <h2 class="title">Examples</h2>
    <p class="para">
     Here are some example PHP scripts parsing XML documents.
    </p>
    <div id="example.xml-structure" class="section">
     <h2 class="title">XML Element Structure Example</h2>
     <p class="para">
      This first example displays the structure of the start elements in
      a document with indentation.
      <div class="example">
       <p><b>Example#1 Show XML Element Structure</b></p>
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"data.xml"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$depth&nbsp;</span><span style="color: #007700">=&nbsp;array();<br /><br />function&nbsp;</span><span style="color: #0000BB">startElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attrs</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;(</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">;&nbsp;</span><span style="color: #0000BB">$i&nbsp;</span><span style="color: #007700">&lt;&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">];&nbsp;</span><span style="color: #0000BB">$i</span><span style="color: #007700">++)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&nbsp;&nbsp;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"$name\n"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">]++;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">endElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$depth</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">]--;<br />}<br /><br /></span><span style="color: #0000BB">$xml_parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">xml_set_element_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"startElement"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"endElement"</span><span style="color: #007700">);<br />if&nbsp;(!(</span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"could&nbsp;not&nbsp;open&nbsp;XML&nbsp;input"</span><span style="color: #007700">);<br />}<br /><br />while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;error:&nbsp;%s&nbsp;at&nbsp;line&nbsp;%d"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
       </div>

      </div>
     </p>
    </div>

    <div id="example.xml-map-tags" class="section">
     <h2 class="title">XML Tag Mapping Example</h2>
     <p class="para">
      <div class="example">
       <p><b>Example#2 Map XML to HTML</b></p>
       <div class="example-contents"><p>
        This example maps tags in an XML document directly to HTML
        tags.  Elements not found in the &quot;map array&quot; are ignored.  Of
        course, this example will only work with a specific XML
        document type.
       </p></div>
       <div class="example-contents"><p>
        <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"data.xml"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$map_array&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"BOLD"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"B"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"EMPHASIS"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"I"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">"LITERAL"&nbsp;&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #DD0000">"TT"<br /></span><span style="color: #007700">);<br /><br />function&nbsp;</span><span style="color: #0000BB">startElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attrs</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">[</span><span style="color: #0000BB">$name</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;$map_array[$name]&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">endElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(isset(</span><span style="color: #0000BB">$map_array</span><span style="color: #007700">[</span><span style="color: #0000BB">$name</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;/$map_array[$name]&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">characterData</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">$xml_parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br /></span><span style="color: #FF8000">//&nbsp;use&nbsp;case-folding&nbsp;so&nbsp;we&nbsp;are&nbsp;sure&nbsp;to&nbsp;find&nbsp;the&nbsp;tag&nbsp;in&nbsp;$map_array<br /></span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_CASE_FOLDING</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">xml_set_element_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"startElement"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"endElement"</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">xml_set_character_data_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"characterData"</span><span style="color: #007700">);<br />if&nbsp;(!(</span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"could&nbsp;not&nbsp;open&nbsp;XML&nbsp;input"</span><span style="color: #007700">);<br />}<br /><br />while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;error:&nbsp;%s&nbsp;at&nbsp;line&nbsp;%d"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
        </div>

       </p></div>
      </div>
     </p>
    </div>

    <div id="example.xml-external-entity" class="section">
     <h2 class="title">XML External Entity Example</h2>
     <p class="para">
      This example highlights XML code.  It illustrates how to use an
      external entity reference handler to include and parse other
      documents, as well as how PIs can be processed, and a way of
      determining &quot;trust&quot; for PIs containing code.
     </p>
     <p class="para">
      XML documents that can be used for this example are found below
      the example (<var class="filename">xmltest.xml</var> and
      <var class="filename">xmltest2.xml</var>.)
     </p>
     <p class="para">
      <div class="example">
       <p><b>Example#3 External Entity Example</b></p>
       <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$file&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"xmltest.xml"</span><span style="color: #007700">;<br /><br />function&nbsp;</span><span style="color: #0000BB">trustedFile</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;only&nbsp;trust&nbsp;local&nbsp;files&nbsp;owned&nbsp;by&nbsp;ourselves<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(!</span><span style="color: #0000BB">eregi</span><span style="color: #007700">(</span><span style="color: #DD0000">"^([a-z]+)://"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&amp;&amp;&nbsp;</span><span style="color: #0000BB">fileowner</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #0000BB">getmyuid</span><span style="color: #007700">())&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">startElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$attribs</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&amp;lt;&lt;font&nbsp;color=\"#0000cc\"&gt;$name&lt;/font&gt;"</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">count</span><span style="color: #007700">(</span><span style="color: #0000BB">$attribs</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;foreach&nbsp;(</span><span style="color: #0000BB">$attribs&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$k&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$v</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&nbsp;&lt;font&nbsp;color=\"#009900\"&gt;$k&lt;/font&gt;=\"&lt;font&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;color=\"#990000\"&gt;$v&lt;/font&gt;\""</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&amp;gt;"</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">endElement</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$name</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&amp;lt;/&lt;font&nbsp;color=\"#0000cc\"&gt;$name&lt;/font&gt;&amp;gt;"</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">characterData</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"&lt;b&gt;$data&lt;/b&gt;"</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">PIHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$target</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;switch&nbsp;(</span><span style="color: #0000BB">strtolower</span><span style="color: #007700">(</span><span style="color: #0000BB">$target</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case&nbsp;</span><span style="color: #DD0000">"php"</span><span style="color: #007700">:<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #FF8000">//&nbsp;If&nbsp;the&nbsp;parsed&nbsp;document&nbsp;is&nbsp;"trusted",&nbsp;we&nbsp;say&nbsp;it&nbsp;is&nbsp;safe<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;to&nbsp;execute&nbsp;PHP&nbsp;code&nbsp;inside&nbsp;it.&nbsp;&nbsp;If&nbsp;not,&nbsp;display&nbsp;the&nbsp;code<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;instead.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #007700">if&nbsp;(</span><span style="color: #0000BB">trustedFile</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">[</span><span style="color: #0000BB">$parser</span><span style="color: #007700">]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;eval(</span><span style="color: #0000BB">$data</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Untrusted&nbsp;PHP&nbsp;code:&nbsp;&lt;i&gt;%s&lt;/i&gt;"</span><span style="color: #007700">,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">defaultHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #DD0000">"&amp;"&nbsp;</span><span style="color: #007700">&amp;&amp;&nbsp;</span><span style="color: #0000BB">substr</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;-</span><span style="color: #0000BB">1</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">)&nbsp;==&nbsp;</span><span style="color: #DD0000">";"</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">'&lt;font&nbsp;color="#aa00aa"&gt;%s&lt;/font&gt;'</span><span style="color: #007700">,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">'&lt;font&nbsp;size="-1"&gt;%s&lt;/font&gt;'</span><span style="color: #007700">,&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">htmlspecialchars</span><span style="color: #007700">(</span><span style="color: #0000BB">$data</span><span style="color: #007700">));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">externalEntityRefHandler</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$openEntityNames</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$base</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$publicId</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!list(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">new_xml_parser</span><span style="color: #007700">(</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"Could&nbsp;not&nbsp;open&nbsp;entity&nbsp;%s&nbsp;at&nbsp;%s\n"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$openEntityNames</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$systemId</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">printf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;error:&nbsp;%s&nbsp;at&nbsp;line&nbsp;%d&nbsp;while&nbsp;parsing&nbsp;entity&nbsp;%s\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">),&nbsp;</span><span style="color: #0000BB">$openEntityNames</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">true</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />}<br /><br />function&nbsp;</span><span style="color: #0000BB">new_xml_parser</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)&nbsp;<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;global&nbsp;</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$xml_parser&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">xml_parser_create</span><span style="color: #007700">();<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_parser_set_option</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">XML_OPTION_CASE_FOLDING</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">1</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_element_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"startElement"</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"endElement"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_character_data_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"characterData"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_processing_instruction_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"PIHandler"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_default_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"defaultHandler"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_set_external_entity_ref_handler</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"externalEntityRefHandler"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!(</span><span style="color: #0000BB">$fp&nbsp;</span><span style="color: #007700">=&nbsp;@</span><span style="color: #0000BB">fopen</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"r"</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">is_array</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">settype</span><span style="color: #007700">(</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">"array"</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$parser_file</span><span style="color: #007700">[</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #0000BB">$file</span><span style="color: #007700">;<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;array(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fp</span><span style="color: #007700">);<br />}<br /><br />if&nbsp;(!(list(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">new_xml_parser</span><span style="color: #007700">(</span><span style="color: #0000BB">$file</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #DD0000">"could&nbsp;not&nbsp;open&nbsp;XML&nbsp;input"</span><span style="color: #007700">);<br />}<br /><br />echo&nbsp;</span><span style="color: #DD0000">"&lt;pre&gt;"</span><span style="color: #007700">;<br />while&nbsp;(</span><span style="color: #0000BB">$data&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">fread</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">4096</span><span style="color: #007700">))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;(!</span><span style="color: #0000BB">xml_parse</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$data</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">feof</span><span style="color: #007700">(</span><span style="color: #0000BB">$fp</span><span style="color: #007700">)))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;die(</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"XML&nbsp;error:&nbsp;%s&nbsp;at&nbsp;line&nbsp;%d\n"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_error_string</span><span style="color: #007700">(</span><span style="color: #0000BB">xml_get_error_code</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">xml_get_current_line_number</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">)));<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />}<br />echo&nbsp;</span><span style="color: #DD0000">"&lt;/pre&gt;"</span><span style="color: #007700">;<br />echo&nbsp;</span><span style="color: #DD0000">"parse&nbsp;complete\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">xml_parser_free</span><span style="color: #007700">(</span><span style="color: #0000BB">$xml_parser</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
       </div>

      </div>
     </p>
     <p class="para">
      <div class="example">
       <p><b>Example#4 xmltest.xml</b></p>
       <div class="example-contents">
<div class="cdata"><pre>
&lt;?xml version=&#039;1.0&#039;?&gt;
&lt;!DOCTYPE chapter SYSTEM &quot;/just/a/test.dtd&quot; [
&lt;!ENTITY plainEntity &quot;FOO entity&quot;&gt;
&lt;!ENTITY systemEntity SYSTEM &quot;xmltest2.xml&quot;&gt;
]&gt;
&lt;chapter&gt;
 &lt;TITLE&gt;Title &amp;plainEntity;&lt;/TITLE&gt;
 &lt;para&gt;
  &lt;informaltable&gt;
   &lt;tgroup cols=&quot;3&quot;&gt;
    &lt;tbody&gt;
     &lt;row&gt;&lt;entry&gt;a1&lt;/entry&gt;&lt;entry morerows=&quot;1&quot;&gt;b1&lt;/entry&gt;&lt;entry&gt;c1&lt;/entry&gt;&lt;/row&gt;
     &lt;row&gt;&lt;entry&gt;a2&lt;/entry&gt;&lt;entry&gt;c2&lt;/entry&gt;&lt;/row&gt;
     &lt;row&gt;&lt;entry&gt;a3&lt;/entry&gt;&lt;entry&gt;b3&lt;/entry&gt;&lt;entry&gt;c3&lt;/entry&gt;&lt;/row&gt;
    &lt;/tbody&gt;
   &lt;/tgroup&gt;
  &lt;/informaltable&gt;
 &lt;/para&gt;
 &amp;systemEntity;
 &lt;section id=&quot;about&quot;&gt;
  &lt;title&gt;About this Document&lt;/title&gt;
  &lt;para&gt;
   &lt;!-- this is a comment --&gt;
   &lt;?php echo &#039;Hi!  This is PHP version &#039; . phpversion(); ?&gt;
  &lt;/para&gt;
 &lt;/section&gt;
&lt;/chapter&gt;
</pre></div>
       </div>

      </div>
     </p>
     <p class="para">
      This file is included from <var class="filename">xmltest.xml</var>:
      <div class="example">
       <p><b>Example#5 xmltest2.xml</b></p>
       <div class="example-contents">
<div class="cdata"><pre>
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE foo [
&lt;!ENTITY testEnt &quot;test entity&quot;&gt;
]&gt;
&lt;foo&gt;
   &lt;element attrib=&quot;value&quot;/&gt;
   &amp;testEnt;
   &lt;?php echo &quot;This is some more PHP code being executed.&quot;; ?&gt;
&lt;/foo&gt;
</pre></div>
       </div>

      </div>
     </p>
    </div>
   </div>
  </div>



















































































































































 <h2>Table of Contents</h2><ul class="chunklist chunklist_reference"><li><a href="function.utf8-decode.html">utf8_decode</a> — Converts a string with ISO-8859-1 characters encoded with UTF-8
   to single-byte ISO-8859-1</li><li><a href="function.utf8-encode.html">utf8_encode</a> — Encodes an ISO-8859-1 string to UTF-8</li><li><a href="function.xml-error-string.html">xml_error_string</a> — Get XML parser error string</li><li><a href="function.xml-get-current-byte-index.html">xml_get_current_byte_index</a> — Get current byte index for an XML parser</li><li><a href="function.xml-get-current-column-number.html">xml_get_current_column_number</a> — Get current column number for an XML parser</li><li><a href="function.xml-get-current-line-number.html">xml_get_current_line_number</a> — Get current line number for an XML parser</li><li><a href="function.xml-get-error-code.html">xml_get_error_code</a> — Get XML parser error code</li><li><a href="function.xml-parse-into-struct.html">xml_parse_into_struct</a> — Parse XML data into an array structure</li><li><a href="function.xml-parse.html">xml_parse</a> — Start parsing an XML document</li><li><a href="function.xml-parser-create-ns.html">xml_parser_create_ns</a> — Create an XML parser with namespace support</li><li><a href="function.xml-parser-create.html">xml_parser_create</a> — Create an XML parser</li><li><a href="function.xml-parser-free.html">xml_parser_free</a> — Free an XML parser</li><li><a href="function.xml-parser-get-option.html">xml_parser_get_option</a> — Get options from an XML parser</li><li><a href="function.xml-parser-set-option.html">xml_parser_set_option</a> — Set options in an XML parser</li><li><a href="function.xml-set-character-data-handler.html">xml_set_character_data_handler</a> — Set up character data handler</li><li><a href="function.xml-set-default-handler.html">xml_set_default_handler</a> — Set up default handler</li><li><a href="function.xml-set-element-handler.html">xml_set_element_handler</a> — Set up start and end element handlers</li><li><a href="function.xml-set-end-namespace-decl-handler.html">xml_set_end_namespace_decl_handler</a> — Set up end namespace declaration handler</li><li><a href="function.xml-set-external-entity-ref-handler.html">xml_set_external_entity_ref_handler</a> — Set up external entity reference handler</li><li><a href="function.xml-set-notation-decl-handler.html">xml_set_notation_decl_handler</a> — Set up notation declaration handler</li><li><a href="function.xml-set-object.html">xml_set_object</a> — Use XML Parser within an object</li><li><a href="function.xml-set-processing-instruction-handler.html">xml_set_processing_instruction_handler</a> — Set up processing instruction (PI) handler</li><li><a href="function.xml-set-start-namespace-decl-handler.html">xml_set_start_namespace_decl_handler</a> — Set up start namespace declaration handler</li><li><a href="function.xml-set-unparsed-entity-decl-handler.html">xml_set_unparsed_entity_decl_handler</a> — Set up unparsed entity declaration handler</li></ul>
</div>
<hr /><div style="text-align: center;">
 <div class="prev" style="float: left;"><a href="function.xdiff-string-patch.html">xdiff_string_patch</a></div>
 <div class="next" style="float: right;"><a href="function.utf8-decode.html">utf8_decode</a></div>
 <div class="up"><a href="funcref.html">Function Reference</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
